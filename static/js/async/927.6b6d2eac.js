"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["927"],{1824:function(e,s,n){n.r(s),n.d(s,{default:function(){return c}});var r=n(1549),i=n(6603);function d(e){let s=Object.assign({h1:"h1",a:"a",p:"p",code:"code",ul:"ul",li:"li",strong:"strong",h2:"h2",h3:"h3",div:"div",pre:"pre"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"模块链接",children:["模块链接",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#模块链接",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:["我们假设有三个服务，分别是 ",(0,r.jsx)(s.code,{children:"ssr-base"}),"、",(0,r.jsx)(s.code,{children:"ssr-module-auth"}),"、",(0,r.jsx)(s.code,{children:"ssr-main"}),"，其中"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"ssr-base"})," 基础服务，负责第三方依赖的管理，以及提供基础的业务组件、工具函数。"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"ssr-module-auth"})," 业务服务，按照业务模块来拆分服务，这里是负责用户认证相关，包含登录、注册、找回密码、验证码相关，最终对外会导出一个路由的配置文件。"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"ssr-main"})," 聚合服务，将不同业务服务导出的路由配置注册进路由总线中，实现应用程序的聚合。"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"基本概念",children:["基本概念",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#基本概念",children:"#"})]}),"\n",(0,r.jsxs)(s.h3,{id:"remote",children:["Remote",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#remote",children:"#"})]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"定义"}),"：提供远程模块供其他应用使用的应用。"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"功能"}),"：导出自己的模块，以便其他应用可以动态加载和运行。"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"特点"}),"：独立、灵活，可独立更新和扩展，共享依赖以优化资源加载。"]}),"\n"]}),"\n",(0,r.jsxs)(s.h3,{id:"host",children:["Host",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#host",children:"#"})]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"定义"}),"：加载并运行远程模块的应用，通常作为微前端架构的宿主。"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"功能"}),"：动态加载 Remote 应用提供的模块，并在需要的地方导入和使用。"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"特点"}),"：整合能力强，能将多个 Remote 应用组合成完整前端应用，提供扩展点和钩子函数。"]}),"\n"]}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive tip",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"TIP"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.p,{children:["每一个服务，既可以是 Host，也可以是 Remote。下面将会以 ",(0,r.jsx)(s.code,{children:"ssr-base"})," 和 ",(0,r.jsx)(s.code,{children:"ssr-main"})," 作为例子，分别扮演 Remote 和 Host，你将会了解到它是如何工作的。\n"]})})]}),"\n",(0,r.jsxs)(s.h2,{id:"无类型导出",children:["无类型导出",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#无类型导出",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:["在执行 ",(0,r.jsx)(s.code,{children:"tsc --declaration --emitDeclarationOnly --outDir dist/src"})," 命令时，由于找不到 ",(0,r.jsx)(s.code,{children:"npm/axios.ts"})," 这个文件，所以不会生成类型文件。"]}),"\n",(0,r.jsxs)(s.h3,{id:"remote-1",children:["Remote",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#remote-1",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:["直接将 ",(0,r.jsx)(s.code,{children:"axios"})," 模块导出。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-base/src/entry.node.ts" {5}',children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    modules: {\n        exports: ['npm:axios']\n    },\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsxs)(s.h3,{id:"host-1",children:["Host",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#host-1",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"ssr-main"})," 此时作为 Host，需要将 ",(0,r.jsx)(s.code,{children:"axios"})," 链接到 ",(0,r.jsx)(s.code,{children:"ssr-base/npm/axios"}),"，并且需要在项目安装 ",(0,r.jsx)(s.code,{children:"axios"})," 模块来获得类型提示。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-main/src/entry.node.ts" {6,9}',children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    modules: {\n        imports: {\n            'ssr-base': 'root:../ssr-base/dist'\n        },\n        externals: {\n            axios: 'ssr-base/npm/axios'\n        }\n    },\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsx)(s.p,{children:"源码："}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import axios from 'axios';\n"})}),"\n",(0,r.jsx)(s.p,{children:"将会被替换成："}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import axios from 'ssr-base/npm/axios';\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"有类型导出",children:["有类型导出",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#有类型导出",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:["在执行 ",(0,r.jsx)(s.code,{children:"tsc --declaration --emitDeclarationOnly --outDir dist/src"})," 命令时，由于存在 ",(0,r.jsx)(s.code,{children:"src/axios.ts"})," 这个文件，就会生成相关的类型文件。"]}),"\n",(0,r.jsxs)(s.h3,{id:"remote-2",children:["Remote",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#remote-2",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:["创建文件，并导出 ",(0,r.jsx)(s.code,{children:"axios"}),"。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-base/src/axios.ts"',children:"export * from 'axios';\n"})}),"\n",(0,r.jsxs)(s.p,{children:["导出 ",(0,r.jsx)(s.code,{children:"axios"})," 软件包。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-base/src/entry.node.ts" {5}',children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    modules: {\n        exports: ['root:src/axios.ts']\n    },\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsxs)(s.h3,{id:"host-2",children:["Host",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#host-2",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"ssr-main"})," 此时作为 Host，需要导入 ",(0,r.jsx)(s.code,{children:"ssr-base"})," 服务。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-main/src/entry.node.ts" {6}',children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    modules: {\n        imports: {\n            'ssr-base': 'root:../ssr-base/dist'\n        }\n    },\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsx)(s.p,{children:"此时，你在业务代码中将会获得类型提示。"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-main/src/app.ts"',children:"import axios from 'ssr-base/src/axios';\n"})}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive tip",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"TIP"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.p,{children:["如果要考虑到老系统需要迁移，你还是可以选择将 ",(0,r.jsx)(s.code,{children:"axios"})," 替换成 ",(0,r.jsx)(s.code,{children:"ssr-base/src/axios"}),"，并且需要安装 ",(0,r.jsx)(s.code,{children:"axios"})," 模块到当前项目下才能获得类型提示。\n"]})})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",meta:'title="ssr-main/src/entry.node.ts" {6}',children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    modules: {\n        externals: {\n            axios: 'ssr-base/src/axios'\n        }\n    },\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"软件包发布",children:["软件包发布",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#软件包发布",children:"#"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"packs.enable"})," 配置为 ",(0,r.jsx)(s.code,{children:"true"})," 时，在编译完成后，会将 ",(0,r.jsx)(s.code,{children:"dist"})," 目录进行归档，写入到 ",(0,r.jsx)(s.code,{children:"dist/client/versions/latest.tgz"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import type { GezOptions } from '@gez/core';\n\nexport default {\n    packs: {\n        enable: true\n    }\n} satisfies GezOptions;\n"})}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive warning",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"WARNING"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsx)(s.p,{children:"未完待续！"})})]})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}let c=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["guide%2Fessentials%2Fmodule-link.mdx"]={toc:[{text:"基本概念",id:"基本概念",depth:2},{text:"Remote",id:"remote",depth:3},{text:"Host",id:"host",depth:3},{text:"无类型导出",id:"无类型导出",depth:2},{text:"Remote",id:"remote-1",depth:3},{text:"Host",id:"host-1",depth:3},{text:"有类型导出",id:"有类型导出",depth:2},{text:"Remote",id:"remote-2",depth:3},{text:"Host",id:"host-2",depth:3},{text:"软件包发布",id:"软件包发布",depth:2}],title:"模块链接",frontmatter:{}}}}]);